<!DOCTYPE html>
<html lang="en">
<head>
    <title>Leader Board</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.15.4/bootstrap-table.min.js"></script>

    <link rel="stylesheet" href="ranking.css">
    <script type="text/javascript">
        $.ajax
        ({
            type: "GET",
            url: "https://login.thrio.com/provider/token-with-authorities",
            dataType: 'json',
            async: false,
            headers: {
                "Authorization": "Basic " + btoa("admin@flashe.com" + ":" + "flashe5701##")
            },
            success: function(result){
                token_ = result.token
            }
        });
    </script>
    <script type="text/javascript">
        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                vars[key] = value;
            });
            return vars;
        }

        $.ajax
        ({
            type: "GET",
            url: "https://chelsea.thrio.com/data/api/types/flash/ranking",
            dataType: 'json',
            async: false,
            headers: {
                "Authorization": token_
            },
            success: function(result){
                data_ = result
            
                yourPromoCode = getUrlVars()["promocode"];
                if (typeof(yourPromoCode) === undefined) {
                    return;
                }
  
                var i;
                for (i = 0; i < result.length; i++) {
                    if (result[i].promoCode == yourPromoCode) {
                        yourIndex = i + 1;
                        usedTime = result[i].total;
                        break;
                    }
                }
            }
        });

        window.onload = function(){
            if (typeof(yourPromoCode) !== "undefined" && typeof(yourIndex) === "number") {
                document.getElementById("yourRanking").style.display = "block";
                document.getElementById('yourIndex').innerHTML = yourIndex;
            }
        };
    </script>
</head>
<body>

<div class="container">  
    <div class="page-header">
        <h1>Top Performers</h1>      
    </div> 
    <div id="yourRanking" class="alert alert-success" role="alert">
        <p>Your Ranking is <b id="yourIndex"></b></p>
    </div>

    <table id="table" data-sort-class="table-active" data-row-style="rowStyle">
        <thead>
          <tr>
            <th data-formatter="runningFormatter">Rank</th>
            <th data-formatter="promoCodeFormatter" data-field="promoCode">User Promo Code</th>
          </tr>
        </thead>
    </table>
    <div class="space"></div>
</div>
<div class="footer">
    <div class="row text-center" style="margin-top: 3%;" >
      <img class="medium" src="./flashLogo.png" alt="Responsive image">   
    </div>
</div>

<script>
   var $table = $('#table') 

    $(function() {
        $table.bootstrapTable({data: data_.slice(0, 10)})
    })

    function runningFormatter(value, row, index) {
        return index+1;
    }

    function promoCodeFormatter(value, row) {
        if (value.length <= 4) {
            return value
        }
        return value.substr(0, 2) + new Array(value.length - 3).join('*') + value.substr([value.length - 2], [value.length - 1])
    }

    function rowStyle(row, index) {
        var classes = [
        'bg-danger text-white',
        'bg-warning text-white',
        'bg-info text-white',
        ]
        if (index < 3) {
            return {
                classes: classes[index]
            }
        }
        return {
            css: {
                color: 'black'
            }
        }
    }
</script>

</body>
</html>

